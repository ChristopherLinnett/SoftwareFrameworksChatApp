<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button size="small" defaultHref="''"></ion-back-button>
    </ion-buttons>
    <ion-title>admin</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <ion-card class="ion-align-items-center">
    <ion-card-header class="ion-text-center">
      <ion-card-title #title>User Management </ion-card-title>
    </ion-card-header>
<ion-item>
  <ion-fab-button *ngIf="role =='superuser' && currentState=='deleteMode' || currentState=='roleChange'" slot="start" color="warning" size='small' (click)="upgradeUser('-')">
  <ion-icon name="remove-circle"></ion-icon>
</ion-fab-button>
    <ion-item>
      <ion-label [hidden]="currentState!='unchecked'" position="floating" for="modUser">
        enter username or email</ion-label>
      <ion-input #userToCheck id="modUser" clearInput="true" [disabled]="currentState!='unchecked'"></ion-input>
      
    </ion-item>
    <ion-fab-button *ngIf="role =='superuser' && currentState=='deleteMode'|| currentState=='roleChange'" slot="end" color="warning" size="small" (click)="upgradeUser('+')">
      <ion-icon name="add-circle"></ion-icon>

    </ion-fab-button>

    </ion-item>
          
          <ion-input #input2 id="secondaryInput" clearInput="true" [placeholder]="secondaryInput"
            [disabled]="currentState=='deleteMode' || currentState=='roleChange'"
            [hidden]="currentState!='createMode' && currentState!='deleteMode' && currentState!='roleChange'"
            style="color:white;"></ion-input>

    <ion-button expand="block" color="primary" (click)="checkUser(userToCheck.value)" *ngIf="currentState=='unchecked'">
      Check User</ion-button>
    <ion-button expand="block" *ngIf="currentState=='createMode'" (click)="createUser(userToCheck.value, input2.value)">
      Add New User</ion-button>
    <ion-button expand="block" color="danger" *ngIf="currentState=='deleteMode' && role=='superuser'"
      (click)="deleteUser()">Remove User</ion-button>
    <ion-button expand="block" color="warning" (click)="updateRole()"
      *ngIf="currentState=='roleChange' && role =='superuser'">Update Role</ion-button>
  </ion-card>

  <ion-content style="height:60%; background-color:darkgray; align-items: center; border:0%; padding:0%;">
    <ion-card>
      <ion-accordion-group style="width:100%; margin-left: 0%; margin-right:0%;">
        <ion-accordion  *ngFor="let group of totalPath, index as i" toggleIcon="" toggleIconSlot="">
          <ion-item slot="header" class="ion-text-center" [ngStyle]="{'--background':i%2==0 ? '#051924' : '#0a2e43'}" style="padding: 0%;margin:0%;border:0%;">
            <ion-fab-button translucent="true" color="success" *ngIf="!checkGroup(group) && queryPath && !editGroup"
              size="small" (click)="addRemoveGroup(queryUser.username,group.id,true)" slot="start">
              <ion-icon name="person-add"></ion-icon>
            </ion-fab-button>
            <ion-fab-button translucent="true" color="danger" *ngIf="checkGroup(group) && queryPath && !editGroup"
              size="small" (click)="addRemoveGroup(queryUser.username,group.id,false)" slot="start">
              <ion-icon name="person-remove"></ion-icon>
            </ion-fab-button>
            <ion-fab-button translucent="true" color="danger" *ngIf="editGroup" size="small"
              (click)="deleteGroup(group.id)" slot="start">
              <ion-icon name="trash"></ion-icon>
            </ion-fab-button>
            <ion-label>{{group.name}}{{i}}</ion-label>
            <ion-fab-button fill="clear" slot="end" *ngIf="!group.editRoom && queryPath" (click)="addRemoveGroupAssist(group.id, true)" color="warning" slot="end" size="small">
              <ion-icon name="clipboard-sharp"></ion-icon>
            </ion-fab-button>
          </ion-item>
          <ion-list slot="content" style="padding: 0%;margin:0%;border:0%;">
            <ion-item *ngFor="let room of group.rooms" style="display:inline-block; padding: 0%;margin:0%;border:0%; width:100%;">
              <ion-label>{{room.name}}</ion-label>
              
              <!-- <ion-fab-button fill="clear" *ngIf="!group.editRoom && queryPath && generateRoomUsers(room.users)" (click)="addRemoveGroupAssist(queryUser.id, group.id, room.id, true)" color="warning" slot="end" size="small">
                <ion-icon name="clipboard-sharp"></ion-icon>
              </ion-fab-button> -->
              <ion-fab-button *ngIf="!group.editRoom && queryPath && !generateRoomUsers(room.users)" color="success" slot="end" size="small" (click)="addRemoveRoom(this.queryUser.username,group.id, room.id, true)">
                <ion-icon name="person-add"></ion-icon>
              </ion-fab-button>
              <ion-fab-button *ngIf="!group.editRoom && queryPath && generateRoomUsers(room.users)" color="danger" slot="end" size="small" (click)="addRemoveRoom(this.queryUser.username,group.id, room.id, false)">
                <ion-icon name="person-remove"></ion-icon>
              </ion-fab-button>
              <ion-fab-button *ngIf="group.editRoom" color="danger" slot="end" size="small" (click)="deleteRoom(group.id, room.id)">
                <ion-icon name="trash"></ion-icon>
              </ion-fab-button>
            </ion-item>
            <ion-item *ngIf="!group.editRoom" class="ion-text-right"(click)="group.editRoom=true">
              <ion-label>Edit Rooms</ion-label>
              <ion-icon name="options" slot="end"></ion-icon>
            </ion-item>
            <ion-item *ngIf="group.editRoom">
              <ion-item slot="start" class="ion-text-left">
                <ion-label position="floating">Room Name</ion-label>
                <ion-input #newChannel class="ion-text-left"></ion-input>
              </ion-item>
              <ion-fab-button slot="end" color="success" size="small" (click)="createRoom(group.id,newChannel.value)">
                <ion-icon name="checkmark"></ion-icon>
              </ion-fab-button>
              <ion-fab-button slot="end" color="warning" size="small" (click)="group.editRoom=false">
                <ion-icon name="close"></ion-icon>
              </ion-fab-button>
            </ion-item>

          </ion-list>
        </ion-accordion>
        <ion-accordion toggleIcon="options" *ngIf="!addGroup">
          <ion-item class="ion-text-right" slot="header" (click)="addGroup=true;editGroup=true">
            <ion-label>Edit Groups</ion-label>
          </ion-item>
        </ion-accordion>
        <ion-item *ngIf="addGroup==true">
          <ion-item slot="start" class="ion-text-left">
            <ion-label position="floating">Group Name</ion-label>
            <ion-input #newGroup class="ion-text-left"></ion-input>
          </ion-item>
          <ion-fab-button slot="end" color="success" size="small" (click)="createGroup(newGroup.value);editGroup=false">
            <ion-icon name="checkmark"></ion-icon>
          </ion-fab-button>
          <ion-fab-button slot="end" color="warning" size="small" (click)="addGroup=false; editGroup=false">
            <ion-icon name="close"></ion-icon>
          </ion-fab-button>
        </ion-item>
      </ion-accordion-group>
    </ion-card>
  </ion-content>

</ion-content>